{% for type in types.protocols where type.name|hasSuffix:"Output" %}
// sourcery:file:{{ type.path|dirname }}/Generated/{{ type.name }}SpyGenerated.swift
// swiftlint:disable:this file_name
// swiftlint:disable all
// swift-format-ignore-file
// swiftformat:disable all

{% for importName in type.allImports %}
#if canImport({{ importName }})
import {{ importName }}
#endif
{% endfor %}

{% if type.associatedTypes.count > 0 %}
public class {{ type.name }}Spy{% for associatedType in type.associatedTypes|sortedValuesByKeys %}{% if forloop.first %}<{% endif %}{{ associatedType.name }}: {{ associatedType.typeName }}{% if not forloop.last %}{% if type.associatedTypes.count > 1 %},{% endif %}{% endif %}{% if forloop.last %}>{% endif %}{% endfor %}: {{ type.name }} {
{% else %}
public final class {{ type.name }}Spy: {{ type.name }} {
{% endif %}

    public init() {}

    public enum Message: HashableWithReflection {
        {% for method in type.methods %}
        {% if method.parameters.count == 0 %}
        case {{ method.callName }}
        {% else %}
        case {{ method.callName }}({% for param in method.parameters %}{{ param.argumentLabel|default:param.name }}: {{ param.typeName }}{% if not forloop.last %}, {% endif %}{% endfor %})
        {% endif %}
        {% endfor %}
        {% for variable in type.variables where variable.writeAccess != "private" and variable.writeAccess != "fileprivate" %}
        case set{{ variable.name|upperFirstLetter }}({{ variable.typeName }})
        {% endfor %}
    }

    public private(set) var messages: [Message] = []

    // MARK: - Captured values
    {% for method in type.methods %}
    {% for param in method.parameters %}
    public private(set) var captured{{ method.callName|upperFirstLetter }}{{ param.name|upperFirstLetter }}: [{{ param.typeName }}] = []
    {% endfor %}
    {% endfor %}

    {% for variable in type.variables where variable.writeAccess != "private" and variable.writeAccess != "fileprivate" %}
    public private(set) var captured{{ variable.name|upperFirstLetter }}: [{{ variable.typeName }}] = []
    {% endfor %}

    // MARK: - {{ type.name }} methods
    {% for method in type.methods %}
    {% if method.isStatic %}
    // Static method: {{ method.name }}
    {% else %}
    public func {{ method.name }} {
        {% for param in method.parameters %}
        captured{{ method.callName|upperFirstLetter }}{{ param.name|upperFirstLetter }}.append({{ param.name }})
        {% endfor %}
        {% if method.parameters.count == 0 %}
        messages.append(.{{ method.callName }})
        {% else %}
        messages.append(.{{ method.callName }}({% for param in method.parameters %}{{ param.argumentLabel|default:param.name }}: {{ param.name }}{% if not forloop.last %}, {% endif %}{% endfor %}))
        {% endif %}
    }
    {% endif %}
    {% endfor %}

    // MARK: - Properties
    {% for variable in type.variables %}
    {% if variable.writeAccess == "private" or variable.writeAccess == "fileprivate" %}
    public var {{ variable.name }}: {{ variable.typeName }}{% if variable.defaultValue %} = {{ variable.defaultValue }}{% endif %}
    {% else %}
    public var {{ variable.name }}: {{ variable.typeName }}{% if variable.defaultValue %} = {{ variable.defaultValue }}{% endif %} {
        didSet {
            captured{{ variable.name|upperFirstLetter }}.append({{ variable.name }})
            messages.append(.set{{ variable.name|upperFirstLetter }}({{ variable.name }}))
        }
    }
    {% endif %}
    {% endfor %}
}
// sourcery:end
{% endfor %}